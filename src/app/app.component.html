<mat-sidenav-container fullscreen>
    <mat-sidenav #sidenav mode="side" opened>
        <app-sidebar></app-sidebar>
    </mat-sidenav>

    <mat-sidenav-content>
        <div class="split-container" [style.display]="tabService.splitMode ? 'flex' : 'block'" style="height: 100%">

            <!-- Pane 0 -->
            <div class="split-pane" [style.width]="tabService.splitMode ? '50%' : '100%'"
                [style.border-right]="tabService.splitMode ? '1px solid #333' : 'none'" (click)="setActivePane(0)"
                [class.active-pane]="tabService.activePane === 0"
                style="height: 100%; display: flex; flex-direction: column;">

                <mat-tab-group id="tab-group-0" [@.disabled]="true" [(selectedIndex)]="tabService.paneTabIndices[0]"
                    mat-stretch-tabs="false" style="flex: 1; overflow: hidden;">
                    @for (tab of tabService.getTabsForPane(0) ; let i = $index; track tab.id) {
                    <mat-tab>
                        <ng-template mat-tab-label>
                            <ng-container
                                *ngTemplateOutlet="tabLabel; context: {tab: tab, i: i, paneId: 0}"></ng-container>
                        </ng-template>
                        <div style="height: 100%">
                            <ng-container *ngTemplateOutlet="tabContent; context: {tab: tab}"></ng-container>
                        </div>
                    </mat-tab>
                    }
                </mat-tab-group>
            </div>

            <!-- Pane 1 -->
            <div class="split-pane" *ngIf="tabService.splitMode"
                style="width: 50%; height: 100%; display: flex; flex-direction: column;" (click)="setActivePane(1)"
                [class.active-pane]="tabService.activePane === 1">

                <mat-tab-group id="tab-group-1" [@.disabled]="true" [(selectedIndex)]="tabService.paneTabIndices[1]"
                    mat-stretch-tabs="false" style="flex: 1; overflow: hidden;">
                    @for (tab of tabService.getTabsForPane(1) ; let i = $index; track tab.id) {
                    <mat-tab>
                        <ng-template mat-tab-label>
                            <ng-container
                                *ngTemplateOutlet="tabLabel; context: {tab: tab, i: i, paneId: 1}"></ng-container>
                        </ng-template>
                        <div style="height: 100%">
                            <ng-container *ngTemplateOutlet="tabContent; context: {tab: tab}"></ng-container>
                        </div>
                    </mat-tab>
                    }
                </mat-tab-group>
            </div>

        </div>

        <!-- Templates -->
        <ng-template #tabLabel let-tab="tab" let-i="i" let-paneId="paneId">
            <div class="tab-label" (mousedown)="onTabLabelMouseDown($event, i, paneId)">
                @if (!tab.connected) {
                <button mat-icon-button (click)="reconnect(i)" aria-label="Reconnect tab">
                    <mat-icon>refresh</mat-icon>
                </button>
                }
                <span>{{ tab.name }} </span>
                <button mat-icon-button (click)="removeTab(i, paneId)" aria-label="Remove tab">
                    <mat-icon>close</mat-icon>
                </button>
            </div>
        </ng-template>

        <ng-template #tabContent let-tab="tab">
            <ng-container>
                @switch(tab.category) {
                @case('TERMINAL') {
                <app-terminal [session]="tab.session"></app-terminal>
                }
                @case('REMOTE_DESKTOP') {
                <app-remote-desktop [session]="tab.session"></app-remote-desktop>
                }
                @case('FILE_EXPLORER') {
                <app-file-explorer [session]="tab.session"></app-file-explorer>
                }
                }
            </ng-container>
        </ng-template>

        @if (modalControl.isMenuModalOpen) {
        <div>
            @switch(modalControl.currentOpenedMenu) {
            @case(MENU_ADD) {
            <app-quickconnect-menu [@slideInOut]="'in'"
                (closeEvent)="modalControl.closeModal(modalControl.currentOpenedMenu)"></app-quickconnect-menu>
            }
            @case(MENU_PROFILE) {
            <app-profiles-menu [@slideInOut]="'in'"
                (closeEvent)="modalControl.closeModal(modalControl.currentOpenedMenu)"></app-profiles-menu>
            }
            @case(MENU_SECURE) {
            <app-secrets-menu [@slideInOut]="'in'"
                (closeEvent)="modalControl.closeModal(modalControl.currentOpenedMenu)"></app-secrets-menu>
            }
            @case(MENU_CLOUD) {
            <app-cloud-menu [@slideInOut]="'in'"
                (closeEvent)="modalControl.closeModal(modalControl.currentOpenedMenu)"></app-cloud-menu>
            }
            @case(MENU_SETTING) {
            <app-setting-menu [@slideInOut]="'in'"
                (closeEvent)="modalControl.closeModal(modalControl.currentOpenedMenu)"></app-setting-menu>
            }
            }
        </div>
        }
    </mat-sidenav-content>
</mat-sidenav-container>
<ngx-spinner bdColor="rgba(0, 0, 0, 0.8)" size="medium" color="#fff" type="ball-scale-multiple" [fullScreen]="true">
    <p style="color: white"> Loading... </p>
</ngx-spinner>